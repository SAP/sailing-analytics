# Upgrading an EC2 Image

We maintain at least one current Amazon Machine Image (AMI) for use with the SAP Sailing Analytics. It can be parameterized with the "user data" during launching one or more EC2 hosts from it. The image has a Linux system installed that during boot runs a sailing-specific start-up script from ``configuration/sailing``. It can run in one of two modes:

* Regular: in this mode, variables set in the user data and an option environment configuration file (property ``USE_ENVIRONMENT``) are added to the ``env.sh`` file in the sailing server directory; furthermore, an ``httpd`` server is launched that is configured based on other user data variables such as ``EVENT_ID`` and ``SERVER_NAME``.
* Image Upgrade: this mode is indicated by a single line of user data containing only the string ``image-upgrade``. In this mode no changes are applied to ``env.sh`` nor the ``httpd`` server configuration file(s). Instead, the ``yum`` package manager is used to upgrade the Linux installation, the git repository under ``/home/sailing/code`` is updated (which implicitly updates the ``/etc.init.d/sailing`` boot script which is a symbolic link to said git repo) and the latest SAP Sailing Analytics release is installed to ``/home/sailing/servers/server``. Furthermore, all previous logs are cleared from ``/home/sailing/servers/server/logs`` and ``/var/log/httpd``. The system is then shut down after which it is ready for producing an upgraded AMI from it.