name: Merge main branch into docker-17 after successful build
on:
  workflow_run:
    workflows: [release]
    types: [completed]
    branches: [main]
  workflow_dispatch: {}
jobs:
  merge-main-into-docker-17:
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: docker-17
          #fetch-depth: 0  # fetch the whole thing to make sure the histories merge
      - name: Merge main into docker-17 and push
        shell: bash
        run: |
          git config --global user.email "github@sapsailing.com"
          git config --global user.name "Github Auto-Merger"
          git fetch origin main:main
          git merge main
          git push
