
<div class="help">Here you can set the UDP port for receiving expedition wind.</div>

<div class="info">
<tal:if condition="view.listenerStarted()">

<form id="exp-track-form" method="POST" action="/++/startWindTracker">
    Event: 
    <select name="event">
        <tal:for repeat="event view.allEvents()">
        <option value="${event.name}">${event.name}</option>
        </tal:for>
    </select>
    &nbsp;
    <input id="receiver-loader" type="button" onclick="listWindTrackers()" value="Load Receiver Information"/>
    &nbsp;
    Race: 
    <select name="racename">
        <tal:for repeat="racename view.allRacesFor()">
        <option value="${racename}">${racename}</option>
        </tal:for>
    </select>
    &nbsp;
    <input id="receiver-stopper" type="button" onclick="stopReceiver()" value="Stop Receiver"/>

    <br/><br/>
    Wind Trackers:
    <div id="wind-trackers">
        <i>No wind trackers registered</i>
    </div>
    <br/><br/>
    <div class="field">
        <span>Port:</span><br/>
        <select name="port">
            <option value="2012">PROD</option>
            <option value="2011">TEST</option>
            <option value="2010">DEV</option>
        </select>
    </div>
    <div class="field">
        <span>Bearing correction by declination?</span><br/>
        <input type="checkbox" name="declination" checked=checked/>
    </div>

    <input type="button" value="Start Receiver" onclick="$('#exp-track-form').submit()"/>

    <div id="receiver-data">
        &nbsp;
    </div>

    <script>
        function listWindTrackers() {
            GET('listWindTrackers', {}, function(data) {
                result = '';
                for (d in data) {
                    result += 'Eventname: ' + data[d].eventname + ' Racename: ' + data[d].racename + 'Port: ' + data[d].port + '<br/>';
                }

                if (result != '')
                    $('#wind-trackers').html(result);
            });
        }
        function stopReceiver() {
            GET('stopReceiver', {
                eventname: $('select[name=event] option:selected').val(), 
                racename: $('select[name=racename] option:selected').val()}, 
            function(data) {
                $('#wind-trackers').html('<i>No wind trackers configured.</i>');
                listWindTrackers();
            });
        }

        listWindTrackers();

        $('#exp-track-form').submit(function() {
            $(this).ajaxSubmit({
                success: function() {
                    listWindTrackers();
                }
            });

            return false;
        });
    </script>
</form>
</tal:if>

<tal:if condition="not view.listenerStarted()">
    <b>Please start listener before trying to read or set expedition wind reader!</b>
</tal:if>
</div>
