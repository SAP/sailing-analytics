#!/bin/bash
if [ $# = 0 ]; then
  PWD=$( pwd )
  RELATIVE_SERVER_DIR=$( basename ${PWD} )
else
  RELATIVE_SERVER_DIR=$1
fi
MAIL_PROPERTIES=mail.properties
SECRETS=secrets
ROOT_MAIL_PROPERTIES=/root/${MAIL_PROPERTIES}
ROOT_SECRETS=/root/${SECRETS}
SAILING_USER=sailing
SERVER_DIR=/home/${SAILING_USER}/servers/${RELATIVE_SERVER_DIR}
CONFIGURATION_DIR=${SERVER_DIR}/configuration
SAILING_MAIL_PROPERTIES=${CONFIGURATION_DIR}/${MAIL_PROPERTIES}
SAILING_SECRETS=${CONFIGURATION_DIR}/${SECRETS}
mkdir -p "${SERVER_DIR}"
chown ${SAILING_USER} ${SERVER_DIR}
chgrp ${SAILING_USER} ${SERVER_DIR}
mkdir -p "${CONFIGURATION_DIR}"
chown ${SAILING_USER} ${CONFIGURATION_DIR}
chgrp ${SAILING_USER} ${CONFIGURATION_DIR}
if [ -f "${ROOT_MAIL_PROPERTIES}" ]; then
  echo "Found ${ROOT_MAIL_PROPERTIES}. Starting to copy to ${SAILING_MAIL_PROPERTIES}"
  cp ${ROOT_MAIL_PROPERTIES} ${SAILING_MAIL_PROPERTIES}
  chown ${SAILING_USER} ${SAILING_MAIL_PROPERTIES}
  chgrp ${SAILING_USER} ${SAILING_MAIL_PROPERTIES}
else
  echo "Did not find ${ROOT_MAIL_PROPERTIES}. Cannot copy."
fi
if [ -f "${ROOT_SECRETS}" ]; then
  echo "Found ${ROOT_SECRETS}. Starting to copy to ${SAILING_SECRETS}"
  cp ${ROOT_SECRETS} ${SAILING_SECRETS}
  chown ${SAILING_USER} ${SAILING_SECRETS}
  chgrp ${SAILING_USER} ${SAILING_SECRETS}
else
  echo "Did not find ${ROOT_SECRETS}. Cannot copy."
fi
