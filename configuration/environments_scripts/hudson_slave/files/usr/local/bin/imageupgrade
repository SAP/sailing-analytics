#!/bin/bash

# Script to deploy on an instance that has an ephemeral volume as /dev/nvme0n1 (adjust env var PARTITION if different)
# Ensures the partition is xfs-formatted, any existing partition contents will be overwritten if formatted otherwise.
# An existing xfs partition will be left alone.
. imageupgrade_functions.sh

METADATA=$( get_ec2_user_data )
echo "Metadata: ${METADATA}"
if echo "${METADATA}" | grep -q "^image-upgrade$"; then
  echo "Image upgrade..."
  LOGON_USER_HOME=/home/ubuntu
  run_apt_update_upgrade
  download_and_install_latest_sap_jvm_8
  run_git_pull
  finalize
fi
